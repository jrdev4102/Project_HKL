<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hklmart.persistence.OrderDAO">

    <select id="getOrderMemberService" resultType="com.hklmart.domain.OrderVO">
        <![CDATA[
        select * from MEMBER WHERE MEMBER_ID = #{memberId}
        ]]>
    </select>

    <select id="getOrderProductService" resultType="com.hklmart.domain.OrderVO">
        <![CDATA[
        select * from PRODUCT WHERE PRODUCT_CODE = #{productCode}
        ]]>
    </select>

    <select id="checkStock" resultType="integer">
        <![CDATA[
        select ${stockSize} from stock where Stock_product_Code = #{productCode}
        ]]>
    </select>

    <insert id="doPay">
        <![CDATA[
        insert into product_order(order_number, order_member_id, order_date, ORDER_State, ORDER_name, ORDER_memo,
                                  ORDER_tel, ORDER_Payment, ORDER_Address_postcode, ORDER_Address, ORDER_Address_member)
        VALUES (SEQ_ORDER_NUMBER.nextval,#{orderMemberId}, sysdate, '주문 완료되었습니다', #{orderName},#{orderMemo},#{orderTel},#{orderPayment},
                #{orderAddressPostcode},#{orderAddress},#{orderAddressMember})
        ]]>
    </insert>

    <insert id="payProductList">
        <selectKey keyProperty="order_list_order_number" order="BEFORE" resultType="long">
            select SEQ_ORDER_NUMBER.currval from dual
        </selectKey>

        <![CDATA[
        insert into product_order_list(order_list_order_number,order_list_product,${stockSizeColumn})
            values (#{order_list_order_number},#{orderProductCode},'1')
        ]]>
    </insert>

</mapper>